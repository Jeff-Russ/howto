--------------------------------------------------------------------------------

# RAILS - HEROKU DEPLOYMENT
  
-------------------------------------------------------------------------------
### 1. Gemfile Update

> Heroku is well known in the Ruby community. It's the most popular Rails host.  
They have very elegant hosting and deployment setup that we would all benefit in  
emulating even if we aren't hosting on Heroku. We push our app to Heroku and it  
provides it with a domain name for deployment.

1. These modifications were made to Gemfile for Heroku compatibility:

		gem 'sqlite3', group: [:development, :test]
		
		# Use postgresql as the database for production
		group :production do
			gem 'pg'
			gem 'rails_12factor'
		end

2. If you just added this, you need to run bundle install
		
		### in project root directory:  
		$ bundle install 

------------------------------------------------------------------------------
### 2. Heroku Account

1. Make and account at heroku.com with the same email address you used with github. 
2. Go to your email to complete the account creation. 
3. Make sure email is verified with github
4. Go back to cloud9 terminal:  

		### in project root directory:  
		$ heroku login
		$ jeffreylynnruss@gmail.com
		$ ******** (one cap, one non alpha-num)
		$ heroku keys:add
		$ Y
		$ heroku create
		
--------------------------------------------------------------------------------
### 3. Deploy to Heroku

> Make sure you are on the master branch and all (stable) changes are merged in. 

		$ git push heroku master
		
--------------------------------------------------------------------------------
### 4. Troubleshooting Heroku

> This grabs the latest copy from Git and sends it to the URL  
If you go to your URL later and it's not there, that's okay, heroku sleeps it.  
If you want to customize your domain name instead of using the one generated by  
heroku, google domain keroku. If you want to view your domains or run console:

		$ heroku domains
		$ heroku run console
		
> If you have trouble depolying you may want to check out `$ heroku logs` You 
may  see that some database doesn't exist on the heroku version and in this case 
you can create it:

		$ heroku run rake db:migrate



You can use heroku pg:reset DATABASE command to reset the entire database. The command will simply drop and create the database.

You have to use heroku rake db:migrate to create the tables then.

Alternatively you can use rake db:reset command locally and then run heroku db:push to update the production db.


# TODO Comment out if OK with secrets being uploaded to the repo
config/initializers/secret_token.rb
config/secrets.yml

http://stackoverflow.com/questions/23180650/how-to-solve-error-missing-secret-key-base-for-production-environment-on-h

http://stackoverflow.com/questions/18556955/heroku-config-secret-key-base-error

http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html

bundle exec rake secrets

heroku restart -a app_name

# The -a is the same as --app
Easily aliased with alias hra='heroku restart --app '
Which you can make a permanent alias by adding it to your .bashrc or .bash_aliases file as described at: http://askubuntu.com/questions/17536/how-do-i-create-a-permanent-bash-alias and
Creating permanent executable aliases
Then you can just type hra app_name

You can restart a specific remote, e.g. "staging" with:

heroku restart -a app_name -r remote_name
Alternatively if you are in the root directory of your rails application you can just type

heroku restart
to restart that app and and you can create an easy alias for that with

alias hr='heroku restart'`
You can place these aliases in your .bashrc file or (preferred) in a .bash_aliases file which is called from .bashrc

http://stackoverflow.com/questions/21544626/how-do-you-manage-secret-keys-and-heroku-with-ruby-on-rails-4-1-0beta1/22458102#22458102
An equivalent for secrets.yml of that Figaro task is provided by the heroku_secrets gem, from https://github.com/alexpeattie/heroku_secrets:

gem 'heroku_secrets', github: 'alexpeattie/heroku_secrets'
This lets you run

rake heroku:secrets RAILS_ENV=production
to make the contents of secrets.yml available to heroku as environment variables.

http://railsinplainenglish.com/2014/03/31/tutorial-set-your-environment-variables-securely-through-figaro/

!!!!!!! figaro heroku:set -e production !!!!!!!
!!!!!!! bundle exec rake figaro:heroku !!!!!!!

https://github.com/laserlemon/figaro#deployment

https://devcenter.heroku.com/articles/renaming-apps


.rb format (not sure about all caps):

	AppName::Application.config.SECRET_KEY_BASE = ''   
	AppName::Application.config.SECRET_TOKEN = ''
	
heroku cli format:

	heroku config:set SECRET_KEY_BASE=''
	heroku config:set SECRET_TOKEN=''